<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>JPR's Tech Notes - gazebo</title>
        <link rel="stylesheet" href="http://jpiramirez.github.io/theme/css/main.css" />
        <link href="http://jpiramirez.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="JPR's Tech Notes Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://jpiramirez.github.io/">JPR's Tech Notes </a></h1>
                <nav><ul>
                    <li><a href="http://jpiramirez.github.io/pages/about-this-site.html">About this site</a></li>
                    <li><a href="http://jpiramirez.github.io/category/python.html">Python</a></li>
                    <li><a href="http://jpiramirez.github.io/category/ros.html">ROS</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://jpiramirez.github.io/gazebo-speedup.html">Lowering the computational load from Gazebo</a></h1>
<footer class="post-info">
        <abbr class="published" title="2015-12-17T19:30:00-06:00">
                Published: Thu 17 December 2015
        </abbr>
		<br />
        <abbr class="modified" title="2015-12-17T19:30:00-06:00">
                Updated: Thu 17 December 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://jpiramirez.github.io/author/juan-pablo-ramirez.html">Juan-Pablo Ramirez</a>
        </address>
<p>In <a href="http://jpiramirez.github.io/category/ros.html">ROS</a>.</p>
<p>tags: <a href="http://jpiramirez.github.io/tag/robotics.html">robotics</a> <a href="http://jpiramirez.github.io/tag/gazebo.html">gazebo</a> </p>
</footer><!-- /.post-info --><p>The <a href="http://gazebosim.org/">Gazebo</a> simulator is a great platform for algorithm testing, and it is very easy to use through <a href="http://ros.org">ROS</a>. However, Gazebo is quite precise in its calculations by default, which is sometimes cause for slowdowns. This happens often when attempting to simulate multiple robots at once.</p>
<p>Here are some tips to reduce the load of the simulator when dealing with these situations.</p>
<h3>Reduce the sampling rate and change the ODE solver</h3>
<p>It seems that the default settings for Gazebo try to get the simulation running at 1 KHz, which quite frankly is a very fast sampling rate, considering the complexity of some simulation scenarios. One first step to reduce the load from Gazebo would be to reduce this rate by half or even more. It is also possible to choose a different ODE solver. I do not know the specifics of the "quick" solver, but it does seem faster and less accurate.</p>
<p>The aforementioned changes can be done by modifying the .world file for our simulation.</p>
<div class="highlight"><pre><span class="nt">&lt;physics</span> <span class="na">type=</span><span class="s">&#39;ode&#39;</span><span class="nt">&gt;</span>
<span class="nt">&lt;max_step_size&gt;</span>0.004000<span class="nt">&lt;/max_step_size&gt;</span>
<span class="nt">&lt;real_time_factor&gt;</span>1.000000<span class="nt">&lt;/real_time_factor&gt;</span>
<span class="nt">&lt;real_time_update_rate&gt;</span>250.000000<span class="nt">&lt;/real_time_update_rate&gt;</span>
<span class="nt">&lt;gravity&gt;</span>0.000000 0.000000 -9.800000<span class="nt">&lt;/gravity&gt;</span>
<span class="nt">&lt;ode&gt;</span>
    <span class="nt">&lt;solver&gt;</span>
        <span class="nt">&lt;type&gt;</span>quick<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;iters&gt;</span>200<span class="nt">&lt;/iters&gt;</span>
    <span class="nt">&lt;/solver&gt;</span>
<span class="nt">&lt;/ode&gt;</span>
<span class="nt">&lt;/physics&gt;</span>
</pre></div>


<p>The real_time_factor tag specifies how fast the simulation should run, with respect to real (wall) time. Keeping it as 1 means that Gazebo will try to run the simulation in "real time", but that is not guaranteed and depends on the system load. </p>
<p>The tags max_step_size and real_time_update_rate should multiply to real_time_factor. In the code snippet we see that the simulation update rate is now 250 Hz, which should be handled a bit better than 1 KHz. An important caveat: if you are using your own controllers for a robot you will have to adjust your gains to the modified sampling rates.</p>
<h3>Change the sampling rate from the sensors</h3>
<p>Some simulated sensors can cause a huge load on the system. Cameras, RGB-D sensors and lidars are examples of this. Sometimes the default configuration files for such sensors will have values that are aimed at providing accuracy or precision. It may be the case that our application can get away with much lower sampling rates, especially if the robot dynamics are "slow". In such cases, we can configure the sensors for slower sampling.</p>
<p>Here is an example from one of the .xacro files I use.</p>
<div class="highlight"><pre><span class="nt">&lt;xacro:include</span> <span class="na">filename=</span><span class="s">&quot;$(find hector_sensors_description)/urdf/generic_camera.urdf.xacro&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;xacro:generic_camera</span> <span class="na">name=</span><span class="s">&quot;downward_cam&quot;</span> <span class="na">parent=</span><span class="s">&quot;base_link&quot;</span> <span class="na">ros_topic=</span><span class="s">&quot;camera/image&quot;</span> <span class="na">cam_info_topic=</span><span class="s">&quot;camera/camera_info&quot;</span> <span class="na">update_rate=</span><span class="s">&quot;10&quot;</span> <span class="na">res_x=</span><span class="s">&quot;640&quot;</span> <span class="na">res_y=</span><span class="s">&quot;480&quot;</span> <span class="na">image_format=</span><span class="s">&quot;R8G8B8&quot;</span> <span class="na">hfov=</span><span class="s">&quot;49.1343426412&quot;</span><span class="nt">&gt;</span>
</pre></div>


<p>This snippet depends on the ROS package hector_sensors_description. The important attribute here is update_rate, from the xacro:generic_camera tag. The original value was 25 Hz and I lowered it to 10 Hz. Since my simulation is using four of these cameras, changing this parameter smoothed things quite a bit. My application may even let me lower it to 5 Hz, but 10 Hz provides a good balance. </p>
<h3>Simplify the world as much as possible</h3>
<p>While simulations that use digital elevation maps and detailed 3D environments are very pleasing to the eye, they may also be unnecessarily slow. If you can get away with simpler meshes and less textures, you could get nice benefits in execution rates.</p>
<p>If you want to take this notion to the extreme, you can run Gazebo in headless mode and avoid any visualization slowdowns. This can also help if your graphics card is lacking rendering power. Let's look at a snippet from one of my .launch files.</p>
<div class="highlight"><pre><span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;world_name&quot;</span> <span class="na">default=</span><span class="s">&quot;$(find service_utd)/worlds/service.world&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;headless&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;gui&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/include&gt;</span>
</pre></div>


<p>The package service_utd contains my world files. The important part here are the arguments headless and gui. Note that while we enable the headless mode, the GUI has to be turned off like this or it will start anyway.</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://jpiramirez.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-50585426-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>